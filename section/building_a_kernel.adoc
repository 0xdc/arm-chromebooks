== Building a kernel ==

Build requirements: `@system bc u-boot-tools vboot-utils dtc`

[options="header"]
|===
| Kernel version | Samsung | HP | config command
| https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git[linux-4.14.y] | **Yes** | No | `make exynos_defconfig`
| https://chromium.googlesource.com/chromiumos/third_party/kernel/[chromeos-3.8] | Yes | **Yes** | `./chromeos/scripts/prepareconfig chromeos-exynos5`
|===

ChromeOS 3.8 requires additional patches for gcc 4.9.4, 5.4.0-r4 and 6.4.0.

    # make zImage
    # make dtbs
    # make modules

----
/dts-v1/;
/ {
	description = "Chrome OS kernel image with one or more FDT blobs";
	#address-cells = <1>;
	images {
		kernel@1{
			description = "kernel";
			data = /incbin/("arch/arm/boot/zImage");
			type = "kernel_noload";
			arch = "arm";
			os = "linux";
			compression = "none";
			load = <0>;
			entry = <0>;
		};
		fdt@1{
			description = "exynos5250-snow.dtb";
			data = /incbin/("arch/arm/boot/dts/exynos5250-snow.dtb");
			type = "flat_dt";
			arch = "arm";
			compression = "none";
			hash@1{
				algo = "sha1";
			};
		};
		fdt@2{
			description = "exynos5250-spring.dtb";
			data = /incbin/("arch/arm/boot/dts/exynos5250-spring.dtb");
			type = "flat_dt";
			arch = "arm";
			compression = "none";
			hash@1{
				algo = "sha1";
			};
		};
	};
	configurations {
		default = "conf@1";
		conf@1{
			description = "snow";
			kernel = "kernel@1";
			fdt = "fdt@1";
		};
		conf@2{
			description = "spring";
			kernel = "kernel@1";
			fdt = "fdt@2";
		};
	};
};
----

    # mkimage -f kernel.its kernel.itb
    # tee cmdline <<<"console=tty1 debug verbose root=/dev/${DEVICE}3 rootwait ro init=/sbin/init"
    # vbutil_kernel --pack exynos5.kpart \
      --keyblock /usr/share/vboot/devkeys/kernel.keyblock \
      --version 1 \
      --signprivate /usr/share/vboot/devkeys/kernel_data_key.vbprivk \
      --config cmdline \
      --bootloader cmdline \
      --vmlinuz kernel.itb \
      --arch arm
    # dd if=exynos5.kpart of=/dev/${DEVICE}1
